<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 interactions | Time Series Forecasting</title>
  <meta name="description" content="3 interactions | Time Series Forecasting" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="3 interactions | Time Series Forecasting" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 interactions | Time Series Forecasting" />
  
  
  

<meta name="author" content="Katherine Wilson" />


<meta name="date" content="2022-02-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="multiple-regression-models.html"/>
<link rel="next" href="distributed-lag-models.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Time Series</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> basics</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#decomposition-models"><i class="fa fa-check"></i><b>1.1</b> Decomposition Models</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#model-assumptions"><i class="fa fa-check"></i><b>1.2</b> Model assumptions</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#examples"><i class="fa fa-check"></i><b>1.3</b> Examples</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#example"><i class="fa fa-check"></i><b>1.3.1</b> Example</a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#example-1"><i class="fa fa-check"></i><b>1.3.2</b> Example</a></li>
<li class="chapter" data-level="1.3.3" data-path="index.html"><a href="index.html#example-2"><i class="fa fa-check"></i><b>1.3.3</b> Example</a></li>
<li class="chapter" data-level="1.3.4" data-path="index.html"><a href="index.html#example-3"><i class="fa fa-check"></i><b>1.3.4</b> Example</a></li>
<li class="chapter" data-level="1.3.5" data-path="index.html"><a href="index.html#example-4"><i class="fa fa-check"></i><b>1.3.5</b> Example</a></li>
<li class="chapter" data-level="1.3.6" data-path="index.html"><a href="index.html#example-5"><i class="fa fa-check"></i><b>1.3.6</b> Example</a></li>
<li class="chapter" data-level="1.3.7" data-path="index.html"><a href="index.html#example-6"><i class="fa fa-check"></i><b>1.3.7</b> Example</a></li>
<li class="chapter" data-level="1.3.8" data-path="index.html"><a href="index.html#example-7"><i class="fa fa-check"></i><b>1.3.8</b> Example</a></li>
<li class="chapter" data-level="1.3.9" data-path="index.html"><a href="index.html#example-8"><i class="fa fa-check"></i><b>1.3.9</b> Example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="multiple-regression-models.html"><a href="multiple-regression-models.html"><i class="fa fa-check"></i><b>2</b> multiple regression models</a>
<ul>
<li class="chapter" data-level="2.0.1" data-path="multiple-regression-models.html"><a href="multiple-regression-models.html#additivie-decomposition-model-with-a-fourth-degree-polynomial-trend"><i class="fa fa-check"></i><b>2.0.1</b> additivie decomposition model with a fourth-degree polynomial trend</a></li>
<li class="chapter" data-level="2.0.2" data-path="multiple-regression-models.html"><a href="multiple-regression-models.html#additive-decomposition-model-with-cosine-and-sine-seasonal-dummies-and-inclusion-of-an-intercept"><i class="fa fa-check"></i><b>2.0.2</b> Additive decomposition model with cosine and sine seasonal dummies and inclusion of an intercept</a></li>
<li class="chapter" data-level="2.0.3" data-path="multiple-regression-models.html"><a href="multiple-regression-models.html#australian-beer"><i class="fa fa-check"></i><b>2.0.3</b> Australian beer</a></li>
<li class="chapter" data-level="2.1" data-path="multiple-regression-models.html"><a href="multiple-regression-models.html#ontario-gas"><i class="fa fa-check"></i><b>2.1</b> Ontario gas</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="interactions.html"><a href="interactions.html"><i class="fa fa-check"></i><b>3</b> interactions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="interactions.html"><a href="interactions.html#example-9"><i class="fa fa-check"></i><b>3.1</b> Example</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="interactions.html"><a href="interactions.html#interaction"><i class="fa fa-check"></i><b>3.1.1</b> Interaction</a></li>
<li class="chapter" data-level="3.1.2" data-path="interactions.html"><a href="interactions.html#example-10"><i class="fa fa-check"></i><b>3.1.2</b> example</a></li>
<li class="chapter" data-level="3.1.3" data-path="interactions.html"><a href="interactions.html#durbin-watson-statistic"><i class="fa fa-check"></i><b>3.1.3</b> Durbin-Watson statistic</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="interactions.html"><a href="interactions.html#weekly-garbage-deposites"><i class="fa fa-check"></i><b>3.2</b> Weekly Garbage Deposites</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="interactions.html"><a href="interactions.html#simple-model"><i class="fa fa-check"></i><b>3.2.1</b> Simple model</a></li>
<li class="chapter" data-level="3.2.2" data-path="interactions.html"><a href="interactions.html#model-3"><i class="fa fa-check"></i><b>3.2.2</b> model 3</a></li>
<li class="chapter" data-level="3.2.3" data-path="interactions.html"><a href="interactions.html#estimated-trends-calculating-the-interaction-terms"><i class="fa fa-check"></i><b>3.2.3</b> Estimated Trends (calculating the interaction terms)</a></li>
<li class="chapter" data-level="3.2.4" data-path="interactions.html"><a href="interactions.html#visualizing-three-trends"><i class="fa fa-check"></i><b>3.2.4</b> Visualizing Three Trends</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="distributed-lag-models.html"><a href="distributed-lag-models.html"><i class="fa fa-check"></i><b>4</b> distributed lag models</a></li>
<li class="chapter" data-level="5" data-path="arima-models.html"><a href="arima-models.html"><i class="fa fa-check"></i><b>5</b> ARIMA models</a></li>
<li class="chapter" data-level="6" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html"><i class="fa fa-check"></i><b>6</b> exponential smoothing</a></li>
<li class="chapter" data-level="7" data-path="combination-of-forecasts.html"><a href="combination-of-forecasts.html"><i class="fa fa-check"></i><b>7</b> combination of forecasts</a></li>
<li class="chapter" data-level="8" data-path="arch-and-garch-models.html"><a href="arch-and-garch-models.html"><i class="fa fa-check"></i><b>8</b> ARCH and GARCH models</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Time Series Forecasting</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="interactions" class="section level1" number="3">
<h1><span class="header-section-number">3</span> interactions</h1>
<p>Partial slopes (change in y for each unit change in x, holding others constant) vs. marginal slopes (simple regression, only one x). Collinearity makes these values different…</p>
<p>For time series, the trigonometric dummies for seasonal strucure and those for calender effects tend to have no correlation with eachother. Also tend to have no correlation with the dummies of seasonality. So, time series presents an interesting case where partial slopes and marginal slopes are almost exactly the same.</p>
<p>If you have a model with seasonal structure with dummies, and a trend, you’ll get certain partial slopes for the seasonal structure. If you add trigonometric pairs for calendar effects, then the dummy variables for calendar effects are barely correalted with seasonal structure, so the variables don’t change that much when you introduce calendar effects.</p>
<p>Use a second regression to remove their influence on the previous X’s. Strip out of X1 the influence of the other X’s. So ,the partial slope of X1 is the same of the slope in simple regression. So, a partial slope is the effect AFTER you have taken into account the other x’s.</p>
<p>Each t test tests the influence of a single predictor beyond the other predictors. What does that x contribute to the model beyond the contributions of all the other X’s taken sequentially. A “last in” test. Same interpretation holds for a partial F test. This assess variables being tested beyond that.</p>
<div id="example-9" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Example</h2>
<p>Simple regression. Sorted ~ Line. If one more line is added, the number of sorts/hour will increase by 1,4446. Other variables not inlcluded are free to vary.</p>
<p><span class="math display">\[
Sorts/Hour = 2,960 + 1,446Lines
\]</span></p>
<p>Lines, sorters, and hours. Now, the interpretation of the partial slope (826)… is that if you add one more line, and hold fixed the number of sorts and truckers, you increase sorts/hours by 826. Don’t hire more workings, just add one more line. Borrow sorts and truckers from existing lines to form the new line. Partial and marginal slope are greatly different.</p>
<p><span class="math display">\[
Sorts/Hour = 739 + 826Lines + 95Sorters + 118Truckers
\]</span></p>
<p>In time series, the partial slopes we saw prior to the variables added are different. The partial slopes will change as more variables are added.</p>
<div id="interaction" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Interaction</h3>
<p>Example: salaries for account level 1. Let y be salary, <span class="math inline">\(x_1\)</span> timeinposition, and <span class="math inline">\(x-2\)</span> a dummy for gender (0 for males and 1 for females). Regress y on <span class="math inline">\(x_1\)</span> for males only and a seperate regression for females. Examine two fitted lines, comparing their intercepts and their slopes. A difference in intercepts signals a difference in entry level salaries, and difference in slopes indicate difference rates of pay increase for two sexes. A difference in slopes signals interaction. That is, the relationship between y (salary) and one of the independent variables, <span class="math inline">\(x_1\)</span>, time in position, differs according to the value of the other independent variable, <span class="math inline">\(x_2\)</span>.</p>
<p>In this example, there is interaction if the relationship between salary and time in position differs according to the other x variable (gender).</p>
<p>Instead of fitting two lines seperately, pool the male and female data to estimate a common erro variables with more degrees of freedom than seperate regressions permit. Leads to more powerful tests, narrower confidence intervals and prediction intervals.</p>
<p>Why is the product the proper method to incorporate interaction? See:</p>
<p><span class="math display">\[
y = \beta_0 + \beta_1x_1 + \beta_2x_2 + \beta_sx_ax_2 + \epsilon \\
= \beta_0 + \beta_1timeinposition + \beta_2gender + \beta_3timeinposition*gender + \epsilon
\]</span></p>
<p>For males this model is</p>
<p><span class="math display">\[
y = \beta_0+\beta_1timeinposition + \epsilon
\]</span></p>
<p>For females this model is</p>
<p><span class="math display">\[
y = \beta_0+\beta_2 + (\beta_1+\beta_3)timeinposition + \epsilon
\]</span>
For males, the intercept is <span class="math inline">\(\beta_0\)</span> and the slope attached to timeinposition is <span class="math inline">\(\beta_1\)</span>. For females, these are the <span class="math inline">\(\beta_0 + \beta_2\)</span> and <span class="math inline">\(\beta_1 +\beta_3\)</span> respectively. If the paraemter <span class="math inline">\(\beta_3\)</span> is present, then we say that there is interaction between timeinposition and gender. This means that the impact of timeinposition upon salary depends on gender.</p>
<p>This allows us to test whether the same or entry level salaries are same, and whether rates of pay increase are the same. If we test if entry level salaries are equal, then hyp = B2 = 0. If not, then females sig differently. For rate of pay increase, B1 is for males, but females if B1 + B3, so test whether B3 is equal to 0 or not in the alternative.</p>
<p>Interaction means that the relationship between ssalary and time in position, if interaction is present, then that relationship is sig. different for the two genders. That is the case when <span class="math inline">\(B_3\)</span> is sig different from 0.</p>
</div>
<div id="example-10" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> example</h3>
<p>The baseline trend is when neither one of them is on duty. The interactions show when they are or are not on duty (add example)</p>
</div>
<div id="durbin-watson-statistic" class="section level3" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Durbin-Watson statistic</h3>
<p>Used to test the null of uncorrelated errors in a time series regression model, against the alternative that errors follow a first-order autoregression with positive lag one correlation</p>
<p><span class="math display">\[
y_ = \beta_0 + \beta_1x_{1t} + \beta_2x_{2t} + ...+ \beta_kx_{kt} + \epsilon_t
\]</span></p>
<p>where the errors <span class="math inline">\(\epsilon_t\)</span> follows a first-order autoregressive model</p>
<p><span class="math display">\[
\epsilon_t = \rho\epsilon_{t-1} + \alpha_t, -1 &lt; \rho &lt;1
\]</span>
<span class="math display">\[
\epsilon_t = \rho\epsilon_{t-1} + \alpha_t, -1 &lt; \rho &lt;1
\]</span></p>
<p>Durbin-Watson tests the null <span class="math inline">\(H_0: \rho = 0\)</span> against the alternatie that <span class="math inline">\(\rho\)</span> is positive.</p>
<p>Calculated with Durbin-Watson statistic:</p>
<p><span class="math display">\[
DW = \frac{\sum_{t=2}^{n}(e_t - e_{t-1})^2}{\sum_{t=1}^{n}e_t^2}
\]</span></p>
<p>and this is approximately equal to 2(1-r) where</p>
<p><span class="math display">\[
r = \frac{\sum_{t=2}^{n}e_te_{t-1}}{\sum_{t=1}^{n}e_t^2}
\]</span></p>
<p>is the sample correlation between adjacent residuals and is an estimate of <span class="math inline">\(\rho\)</span>. The null is rejected if</p>
<p><span class="math display">\[
DW &gt; d_t
\]</span></p>
</div>
</div>
<div id="weekly-garbage-deposites" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Weekly Garbage Deposites</h2>
<div id="simple-model" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Simple model</h3>
<p>with only a trend structure, dummy variables for two people, and dummy variables to estimate seasonal structure</p>
<p>Fundamental pair corresponds to a period of 365/7, which is 57 and 1/7. Takes 57 and 1/7 to span a week. Use 365.25 for leap year. The fundamental component has a period… the amount of time it takes to complete one cycle is. 52 1/7 weeks. First overtone inorporate j=t, then j=3, j=4…
<span class="math display">\[
y_t = \beta_0 + \beta_t + \beta_2t^2 + \beta_3t^3 + \beta_4M_t + \beta_5G_t + \beta_6MG_t + \sum_{j=1}^{4}(\gamma_jcos\frac{2\pi7jt}{365} + \delta_jsin\frac{2\pi7jt}{365}) + \epsilon_t
\]</span></p>
<p>Dummy variables use the 0,1 convension, where M is 1 is Marlene on during week t, and 0 otherwise… MG for both Marleen and George on duty during week 1.
## Code</p>
<p>Purpose is to estimate how much stolen. The value attached to marlene suggests that the amount of shortage on the tonnage was 164.9, and for George, was 152.5. When two working together, we add these three, and the coefficient is positive, same order of magnitude. Some of the cosine/sin terms are sig…</p>
<p>From this week, we can get week by week losses in tonnage. Interpretation: in a week when Marlone alone working, the amount lost is 1.64… Add them up to get estimate of total amount of loss tonnage, and revenue…</p>
<p>Modestly significant lag 15 residual autocorrelaiton. Otherwise, the plot reveals no remaining autocorrelation. The next plots show the estimated seasonal and trend structures.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="interactions.html#cb1-1" aria-hidden="true" tabindex="-1"></a>garbage <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;/cloud/project/data/Garbage (1).txt&quot;</span>)</span>
<span id="cb1-2"><a href="interactions.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(garbage)</span>
<span id="cb1-3"><a href="interactions.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(garbage)</span></code></pre></div>
<pre><code>##     date fiscalyr   fee tonnage marlene george mg
## 1 123084       85 28.26  321.14       0      1  0
## 2  10685       85 28.26  319.75       0      0  0
## 3  11385       85 28.26  199.35       1      0  0
## 4  12085       85 28.26  151.59       1      0  0
## 5  12785       85 28.26  137.98       0      1  0
## 6  20385       85 28.26  106.76       0      1  0</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="interactions.html#cb3-1" aria-hidden="true" tabindex="-1"></a>freq <span class="ot">&lt;-</span> <span class="dv">14</span><span class="sc">*</span>pi<span class="sc">/</span><span class="dv">365</span></span>
<span id="cb3-2"><a href="interactions.html#cb3-2" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tonnage))</span>
<span id="cb3-3"><a href="interactions.html#cb3-3" aria-hidden="true" tabindex="-1"></a>time2 <span class="ot">&lt;-</span> time<span class="sc">*</span>time; time3 <span class="ot">&lt;-</span> time<span class="sc">*</span>time2</span>
<span id="cb3-4"><a href="interactions.html#cb3-4" aria-hidden="true" tabindex="-1"></a>cosm <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">length</span>(tonnage), <span class="at">ncol =</span> <span class="dv">8</span>)</span>
<span id="cb3-5"><a href="interactions.html#cb3-5" aria-hidden="true" tabindex="-1"></a>sinm <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">length</span>(tonnage), <span class="at">ncol =</span> <span class="dv">8</span>)</span>
<span id="cb3-6"><a href="interactions.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>){</span>
<span id="cb3-7"><a href="interactions.html#cb3-7" aria-hidden="true" tabindex="-1"></a>  cosm[,j]<span class="ot">&lt;-</span> <span class="fu">cos</span>(freq<span class="sc">*</span>j<span class="sc">*</span>time)</span>
<span id="cb3-8"><a href="interactions.html#cb3-8" aria-hidden="true" tabindex="-1"></a>  sinm[,j] <span class="ot">&lt;-</span> <span class="fu">sin</span>(freq<span class="sc">*</span>j<span class="sc">*</span>time)</span>
<span id="cb3-9"><a href="interactions.html#cb3-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-10"><a href="interactions.html#cb3-10" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(tonnage<span class="sc">~</span>time<span class="sc">+</span>time2<span class="sc">+</span>time3<span class="sc">+</span>marlene<span class="sc">+</span>george<span class="sc">+</span>mg<span class="sc">+</span>cosm[,<span class="dv">1</span>]<span class="sc">+</span>sinm[,<span class="dv">1</span>]<span class="sc">+</span>cosm[,<span class="dv">2</span></span>
<span id="cb3-11"><a href="interactions.html#cb3-11" aria-hidden="true" tabindex="-1"></a>]<span class="sc">+</span>sinm[,<span class="dv">2</span>]<span class="sc">+</span>cosm[,<span class="dv">3</span>]<span class="sc">+</span>sinm[,<span class="dv">3</span>]<span class="sc">+</span>cosm[,<span class="dv">4</span>]<span class="sc">+</span>sinm[,<span class="dv">4</span>]);<span class="fu">summary</span>(model1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = tonnage ~ time + time2 + time3 + marlene + george + 
##     mg + cosm[, 1] + sinm[, 1] + cosm[, 2] + sinm[, 2] + cosm[, 
##     3] + sinm[, 3] + cosm[, 4] + sinm[, 4])
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -163.84  -43.74   -5.90   46.93  202.97 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  3.936e+02  2.925e+01  13.456  &lt; 2e-16 ***
## time         6.567e-01  1.463e+00   0.449 0.654308    
## time2       -2.851e-02  2.176e-02  -1.311 0.192157    
## time3        1.753e-04  9.197e-05   1.906 0.058641 .  
## marlene     -1.649e+02  1.595e+01 -10.337  &lt; 2e-16 ***
## george      -1.525e+02  1.584e+01  -9.629  &lt; 2e-16 ***
## mg           1.455e+02  4.147e+01   3.509 0.000606 ***
## cosm[, 1]   -7.276e+00  8.179e+00  -0.890 0.375205    
## sinm[, 1]   -2.373e+01  9.201e+00  -2.579 0.010943 *  
## cosm[, 2]   -8.517e-01  8.164e+00  -0.104 0.917058    
## sinm[, 2]   -5.748e+01  8.422e+00  -6.824 2.46e-10 ***
## cosm[, 3]    9.862e+00  8.188e+00   1.204 0.230464    
## sinm[, 3]   -3.512e+01  8.245e+00  -4.260 3.73e-05 ***
## cosm[, 4]   -2.748e+01  8.205e+00  -3.349 0.001041 ** 
## sinm[, 4]    4.516e+00  8.163e+00   0.553 0.581010    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 71.33 on 140 degrees of freedom
## Multiple R-squared:  0.639,  Adjusted R-squared:  0.6029 
## F-statistic:  17.7 on 14 and 140 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>No strong outliers. Not that much trending.. and don’t go to higher order polynomial. Minor heteroskedasticity. Volatility changes a bit.. Week 50 to week 80, it is common in terms of up and down motion. Modest amount of change in volatility.</p>
<p>ACF of residuals: have we reduced to white noise? Significant lag 15 correlation, but not very far… Model essentially reduces to white noise. No remaining autocorrelation structure.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="interactions.html#cb5-1" aria-hidden="true" tabindex="-1"></a>resids <span class="ot">&lt;-</span> <span class="fu">resid</span>(model1)</span>
<span id="cb5-2"><a href="interactions.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(resids)</span>
<span id="cb5-3"><a href="interactions.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(resids)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="interactions.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ts</span>(resids))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-2-2.png" width="672" /></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="interactions.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">ts</span>(resids))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-2-3.png" width="672" /></p>
<p>Estimate of the seasonal pattern. Sicne the data start at end of 84, there is a dip in collection at early Jan, then reach a peak in the spring, smaller peak in the summer. Then, big peak in the fall, and the peak in the fall is more substantial than in the spring. This is the static seasonal estimation, and static because we have the same pattern from one year to the next. We need 157 to have three complete years.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="interactions.html#cb8-1" aria-hidden="true" tabindex="-1"></a>xmatrix<span class="ot">&lt;-</span></span>
<span id="cb8-2"><a href="interactions.html#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span>(<span class="fu">c</span>(cosm[,<span class="dv">1</span>],sinm[,<span class="dv">1</span>],cosm[,<span class="dv">2</span>],sinm[,<span class="dv">2</span>],cosm[,<span class="dv">3</span>],sinm[,<span class="dv">3</span>],cosm[,<span class="dv">4</span>]</span>
<span id="cb8-3"><a href="interactions.html#cb8-3" aria-hidden="true" tabindex="-1"></a>,sinm[,<span class="dv">4</span>]),<span class="at">ncol=</span><span class="dv">8</span>) </span>
<span id="cb8-4"><a href="interactions.html#cb8-4" aria-hidden="true" tabindex="-1"></a>betaest<span class="ot">&lt;-</span><span class="fu">coef</span>(model1)[<span class="dv">8</span><span class="sc">:</span><span class="dv">15</span>] </span>
<span id="cb8-5"><a href="interactions.html#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="interactions.html#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ts</span>(xmatrix<span class="sc">%*%</span>betaest),<span class="at">xlab=</span><span class="st">&quot;Time&quot;</span>,<span class="at">ylab=</span><span class="st">&quot;Seasonal&quot;</span>,<span class="at">main=</span><span class="st">&quot;Estimated </span></span>
<span id="cb8-7"><a href="interactions.html#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="st">Seasonal from Model 1&quot;</span>) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>In next fit, model 2, we add four more overtone pairs to the seasonal component. Are these significant beyond the original four? Keep time cubed, and for the additional trig pairs, none are sig. R squared raised by about 3.25% from previous model.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="interactions.html#cb9-1" aria-hidden="true" tabindex="-1"></a>model2<span class="ot">&lt;-</span> <span class="fu">lm</span>(tonnage<span class="sc">~</span>time<span class="sc">+</span>time2<span class="sc">+</span>time3<span class="sc">+</span>marlene<span class="sc">+</span>george<span class="sc">+</span>mg<span class="sc">+</span>cosm[,<span class="dv">1</span>]<span class="sc">+</span>sinm[,<span class="dv">1</span>]<span class="sc">+</span>cosm[,</span>
<span id="cb9-2"><a href="interactions.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>]<span class="sc">+</span>sinm[,<span class="dv">2</span>]<span class="sc">+</span>cosm[,<span class="dv">3</span>]<span class="sc">+</span>sinm[,<span class="dv">3</span>]<span class="sc">+</span>cosm[,<span class="dv">4</span>]<span class="sc">+</span>sinm[,<span class="dv">4</span>]<span class="sc">+</span>cosm[,<span class="dv">5</span>]<span class="sc">+</span>sinm[,<span class="dv">5</span>]<span class="sc">+</span>cosm</span>
<span id="cb9-3"><a href="interactions.html#cb9-3" aria-hidden="true" tabindex="-1"></a>[,<span class="dv">6</span>]<span class="sc">+</span>sinm[,<span class="dv">6</span>]<span class="sc">+</span>cosm[,<span class="dv">7</span>]<span class="sc">+</span>sinm[,<span class="dv">7</span>]<span class="sc">+</span>cosm[,<span class="dv">8</span>]<span class="sc">+</span>sinm[,<span class="dv">8</span>]);<span class="fu">summary</span>(model2) </span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = tonnage ~ time + time2 + time3 + marlene + george + 
##     mg + cosm[, 1] + sinm[, 1] + cosm[, 2] + sinm[, 2] + cosm[, 
##     3] + sinm[, 3] + cosm[, 4] + sinm[, 4] + cosm[, 5] + sinm[, 
##     5] + cosm[, 6] + sinm[, 6] + cosm[, 7] + sinm[, 7] + cosm[, 
##     8] + sinm[, 8])
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -159.800  -44.346   -5.717   46.003  193.304 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  3.904e+02  2.892e+01  13.499  &lt; 2e-16 ***
## time         8.096e-01  1.451e+00   0.558 0.577700    
## time2       -3.007e-02  2.157e-02  -1.394 0.165651    
## time3        1.798e-04  9.119e-05   1.972 0.050723 .  
## marlene     -1.669e+02  1.578e+01 -10.576  &lt; 2e-16 ***
## george      -1.533e+02  1.560e+01  -9.831  &lt; 2e-16 ***
## mg           1.554e+02  4.132e+01   3.761 0.000254 ***
## cosm[, 1]   -8.123e+00  8.027e+00  -1.012 0.313382    
## sinm[, 1]   -2.306e+01  9.057e+00  -2.546 0.012059 *  
## cosm[, 2]   -1.841e+00  8.014e+00  -0.230 0.818646    
## sinm[, 2]   -5.747e+01  8.270e+00  -6.949 1.52e-10 ***
## cosm[, 3]    8.664e+00  8.043e+00   1.077 0.283352    
## sinm[, 3]   -3.498e+01  8.091e+00  -4.323 3.01e-05 ***
## cosm[, 4]   -2.870e+01  8.061e+00  -3.560 0.000516 ***
## sinm[, 4]    4.633e+00  8.009e+00   0.579 0.563898    
## cosm[, 5]   -1.277e+01  8.023e+00  -1.591 0.113912    
## sinm[, 5]   -5.617e+00  8.005e+00  -0.702 0.484070    
## cosm[, 6]   -1.055e+01  8.003e+00  -1.318 0.189744    
## sinm[, 6]    6.238e+00  7.953e+00   0.784 0.434210    
## cosm[, 7]   -1.559e+01  8.022e+00  -1.943 0.054104 .  
## sinm[, 7]    7.110e+00  7.952e+00   0.894 0.372864    
## cosm[, 8]   -9.858e+00  8.036e+00  -1.227 0.222149    
## sinm[, 8]    1.298e+01  7.948e+00   1.634 0.104717    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 69.96 on 132 degrees of freedom
## Multiple R-squared:  0.6726, Adjusted R-squared:  0.618 
## F-statistic: 12.32 on 22 and 132 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Partial F test to compare model 1 and model 2. This tests the eight additional variables in the four additional cosine/sin pairs.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="interactions.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model1, model2)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: tonnage ~ time + time2 + time3 + marlene + george + mg + cosm[, 
##     1] + sinm[, 1] + cosm[, 2] + sinm[, 2] + cosm[, 3] + sinm[, 
##     3] + cosm[, 4] + sinm[, 4]
## Model 2: tonnage ~ time + time2 + time3 + marlene + george + mg + cosm[, 
##     1] + sinm[, 1] + cosm[, 2] + sinm[, 2] + cosm[, 3] + sinm[, 
##     3] + cosm[, 4] + sinm[, 4] + cosm[, 5] + sinm[, 5] + cosm[, 
##     6] + sinm[, 6] + cosm[, 7] + sinm[, 7] + cosm[, 8] + sinm[, 
##     8]
##   Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)
## 1    140 712345                           
## 2    132 646145  8     66200 1.6905 0.1063</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="interactions.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)<span class="sc">$</span>r.squared</span></code></pre></div>
<pre><code>## [1] 0.6390179</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="interactions.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)<span class="sc">$</span>r.squared</span></code></pre></div>
<pre><code>## [1] 0.672565</code></pre>
<p>Partial F stat calcualted with</p>
<p><span class="math display">\[
\frac{0.63902 -0.63902/8}{(1-0.63902)/(155-22-1)}
\]</span>
The addition of the 4 trigonometric pairs gives this nuance.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="interactions.html#cb17-1" aria-hidden="true" tabindex="-1"></a>xmatrix3<span class="ot">&lt;-</span></span>
<span id="cb17-2"><a href="interactions.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span>(<span class="fu">c</span>(cosm[,<span class="dv">1</span>],sinm[,<span class="dv">1</span>],cosm[,<span class="dv">2</span>],sinm[,<span class="dv">2</span>],cosm[,<span class="dv">3</span>],sinm[,<span class="dv">3</span>],cosm[,<span class="dv">4</span>]</span>
<span id="cb17-3"><a href="interactions.html#cb17-3" aria-hidden="true" tabindex="-1"></a>,sinm[,<span class="dv">4</span>],cosm[,<span class="dv">5</span>],sinm[,<span class="dv">5</span>],cosm[,<span class="dv">6</span>],sinm[,<span class="dv">6</span>],cosm[,<span class="dv">7</span>],sinm[,<span class="dv">7</span>],cosm[,<span class="dv">8</span></span>
<span id="cb17-4"><a href="interactions.html#cb17-4" aria-hidden="true" tabindex="-1"></a>],sinm[,<span class="dv">8</span>]),<span class="at">ncol=</span><span class="dv">16</span>) </span>
<span id="cb17-5"><a href="interactions.html#cb17-5" aria-hidden="true" tabindex="-1"></a>betaest<span class="ot">&lt;-</span><span class="fu">coef</span>(model2)[<span class="dv">8</span><span class="sc">:</span><span class="dv">23</span>] </span>
<span id="cb17-6"><a href="interactions.html#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ts</span>(xmatrix3<span class="sc">%*%</span>betaest),<span class="at">xlab=</span><span class="st">&quot;Time&quot;</span>,<span class="at">ylab=</span><span class="st">&quot;Seasonal&quot;</span>,<span class="at">main=</span><span class="st">&quot;Estimated </span></span>
<span id="cb17-7"><a href="interactions.html#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="st">Seasonal from Model 2&quot;</span>) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="model-3" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> model 3</h3>
<p>Back to 4 cosine sin pairs, but this is include interaction of M, G and the trend and MG.</p>
<p>In the weeks when marnele on duty, time:marlene is adjustment to time. The line time2:marlene is an adjustment to the value of time2. Likewise for George and MG. We get four different trends, a trend when neither of them is on duty, one when Marlene alone on duty, and one when George alone on duty.</p>
<p>These product terms allow us to get different estimated trends. One estimated trend for Marlene, and one for George, and one estimated for when neither was working, and four weeks when they were working together.</p>
<p>Rsquared slightly less than model 2. Product terms minimally sig. Partial F sig, so keep these significant terms</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="interactions.html#cb18-1" aria-hidden="true" tabindex="-1"></a>model3<span class="ot">&lt;-</span> <span class="fu">lm</span>(tonnage<span class="sc">~</span>time<span class="sc">+</span>time2<span class="sc">+</span>time3<span class="sc">+</span>marlene<span class="sc">+</span>george<span class="sc">+</span>mg<span class="sc">+</span>cosm[,<span class="dv">1</span>]<span class="sc">+</span>sinm[,<span class="dv">1</span>]</span>
<span id="cb18-2"><a href="interactions.html#cb18-2" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span>cosm[,<span class="dv">2</span>]<span class="sc">+</span>sinm[,<span class="dv">2</span>]<span class="sc">+</span>cosm[,<span class="dv">3</span>]<span class="sc">+</span>sinm[,<span class="dv">3</span>]<span class="sc">+</span>cosm[,<span class="dv">4</span>]<span class="sc">+</span>sinm[,<span class="dv">4</span>]<span class="sc">+</span></span>
<span id="cb18-3"><a href="interactions.html#cb18-3" aria-hidden="true" tabindex="-1"></a>              marlene<span class="sc">*</span>time<span class="sc">+</span>marlene<span class="sc">*</span>time2<span class="sc">+</span>george<span class="sc">*</span>time<span class="sc">+</span>george<span class="sc">*</span>time2<span class="sc">+</span>mg<span class="sc">*</span>time<span class="sc">+</span>mg<span class="sc">*</span>time2)</span>
<span id="cb18-4"><a href="interactions.html#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="interactions.html#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model3) </span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = tonnage ~ time + time2 + time3 + marlene + george + 
##     mg + cosm[, 1] + sinm[, 1] + cosm[, 2] + sinm[, 2] + cosm[, 
##     3] + sinm[, 3] + cosm[, 4] + sinm[, 4] + marlene * time + 
##     marlene * time2 + george * time + george * time2 + mg * time + 
##     mg * time2)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -165.393  -37.033    1.136   43.853  210.728 
## 
## Coefficients:
##                 Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    3.251e+02  4.589e+01   7.084 7.18e-11 ***
## time           2.583e+00  1.805e+00   1.431  0.15481    
## time2         -3.712e-02  2.265e-02  -1.639  0.10355    
## time3          1.611e-04  9.126e-05   1.766  0.07970 .  
## marlene       -9.766e+01  4.949e+01  -1.973  0.05052 .  
## george        -5.181e+01  4.954e+01  -1.046  0.29746    
## mg             1.044e+03  5.181e+02   2.016  0.04581 *  
## cosm[, 1]     -4.710e+00  8.160e+00  -0.577  0.56481    
## sinm[, 1]     -2.563e+01  9.080e+00  -2.823  0.00548 ** 
## cosm[, 2]     -3.089e+00  8.162e+00  -0.378  0.70572    
## sinm[, 2]     -5.918e+01  8.287e+00  -7.141 5.31e-11 ***
## cosm[, 3]      1.023e+01  8.076e+00   1.267  0.20728    
## sinm[, 3]     -3.180e+01  8.185e+00  -3.885  0.00016 ***
## cosm[, 4]     -2.648e+01  8.100e+00  -3.269  0.00137 ** 
## sinm[, 4]      4.637e+00  8.063e+00   0.575  0.56617    
## time:marlene  -2.437e+00  1.408e+00  -1.731  0.08575 .  
## time2:marlene  1.540e-02  8.499e-03   1.812  0.07229 .  
## time:george   -2.622e+00  1.420e+00  -1.847  0.06695 .  
## time2:george   1.299e-02  8.625e-03   1.506  0.13437    
## time:mg       -3.524e+01  2.027e+01  -1.738  0.08443 .  
## time2:mg       2.543e-01  1.477e-01   1.721  0.08749 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 69.85 on 134 degrees of freedom
## Multiple R-squared:  0.6686, Adjusted R-squared:  0.6192 
## F-statistic: 13.52 on 20 and 134 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div id="estimated-trends-calculating-the-interaction-terms" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Estimated Trends (calculating the interaction terms)</h3>
<p>$$
Neither:</p>
<p>325.082 + 2.5825t - 0.0371196t^2 + 0.00016114t^3
$$</p>
</div>
<div id="visualizing-three-trends" class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Visualizing Three Trends</h3>
<p>Black line, neither on duty, Blue trend is G, Red trend is Marlene. At the far left, Marlene usually stealing more than George. As time goes on, G stealing more. In the first few weeks, not a lot was being stolen. But at the end of two years, a lot more being stolen.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="interactions.html#cb20-1" aria-hidden="true" tabindex="-1"></a>nmatrix<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">length</span>(tonnage)),time,time2,time3),<span class="at">ncol=</span><span class="dv">4</span>) </span>
<span id="cb20-2"><a href="interactions.html#cb20-2" aria-hidden="true" tabindex="-1"></a>nbeta<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fl">325.082</span>,<span class="fl">2.5825</span>,<span class="sc">-</span><span class="fl">0.0371196</span>,<span class="fl">0.00016114</span>) </span>
<span id="cb20-3"><a href="interactions.html#cb20-3" aria-hidden="true" tabindex="-1"></a>mbeta<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fl">227.422</span>,<span class="fl">0.14524</span>,<span class="sc">-</span><span class="fl">0.021722</span>,<span class="fl">0.00016114</span>) </span>
<span id="cb20-4"><a href="interactions.html#cb20-4" aria-hidden="true" tabindex="-1"></a>gbeta<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fl">273.269</span>,<span class="sc">-</span><span class="fl">0.03985</span>,<span class="sc">-</span><span class="fl">0.024129</span>,<span class="fl">0.00016114</span>) </span>
<span id="cb20-5"><a href="interactions.html#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="interactions.html#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ts</span>(nmatrix<span class="sc">%*%</span>nbeta),<span class="at">type=</span><span class="st">&quot;l&quot;</span>,<span class="at">lty=</span><span class="dv">1</span>,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">&quot;black&quot;</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">500</span></span>
<span id="cb20-7"><a href="interactions.html#cb20-7" aria-hidden="true" tabindex="-1"></a>),<span class="at">xlab=</span><span class="st">&quot;Time&quot;</span>,<span class="at">ylab=</span><span class="st">&quot;Trend&quot;</span>,<span class="at">main=</span><span class="st">&quot;Estimated Trends from Model 3&quot;</span>) </span>
<span id="cb20-8"><a href="interactions.html#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">ts</span>(nmatrix<span class="sc">%*%</span>mbeta),<span class="at">type=</span><span class="st">&quot;l&quot;</span>,<span class="at">lty=</span><span class="dv">2</span>,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">&quot;red&quot;</span>) </span>
<span id="cb20-9"><a href="interactions.html#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">ts</span>(nmatrix<span class="sc">%*%</span>gbeta),<span class="at">type=</span><span class="st">&quot;l&quot;</span>,<span class="at">lty=</span><span class="dv">3</span>,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">&quot;blue&quot;</span>) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="interactions.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ts</span>(<span class="fu">resid</span>(model3)))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-8-2.png" width="672" /></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="interactions.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">ts</span>(<span class="fu">resid</span>(model3)))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-8-3.png" width="672" /></p>
<p>Model extension of the second and third models, including eight trigonometric pairs and the interactions. Four additional cosine sin pairs for estimation of the seasonal pattern. Brings R squared to over 70%. The amount by which R squared goes up can be used to conduct the partial F test to see if sig.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="interactions.html#cb23-1" aria-hidden="true" tabindex="-1"></a>model4<span class="ot">&lt;-</span> <span class="fu">lm</span>(tonnage<span class="sc">~</span>time<span class="sc">+</span>time2<span class="sc">+</span>time3<span class="sc">+</span>marlene<span class="sc">+</span>george<span class="sc">+</span>mg<span class="sc">+</span>cosm[,<span class="dv">1</span>]<span class="sc">+</span>sinm[,<span class="dv">1</span>]<span class="sc">+</span>cosm[,</span>
<span id="cb23-2"><a href="interactions.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>]<span class="sc">+</span>sinm[,<span class="dv">2</span>]<span class="sc">+</span>cosm[,<span class="dv">3</span>]<span class="sc">+</span>sinm[,<span class="dv">3</span>]<span class="sc">+</span>cosm[,<span class="dv">4</span>]<span class="sc">+</span>sinm[,<span class="dv">4</span>]<span class="sc">+</span>cosm[,<span class="dv">5</span>]<span class="sc">+</span>sinm[,<span class="dv">5</span>]<span class="sc">+</span>cosm</span>
<span id="cb23-3"><a href="interactions.html#cb23-3" aria-hidden="true" tabindex="-1"></a>[,<span class="dv">6</span>]<span class="sc">+</span>sinm[,<span class="dv">6</span>]<span class="sc">+</span>cosm[,<span class="dv">7</span>]<span class="sc">+</span>sinm[,<span class="dv">7</span>]<span class="sc">+</span>cosm[,<span class="dv">8</span>]<span class="sc">+</span>sinm[,<span class="dv">8</span>]<span class="sc">+</span>marlene<span class="sc">*</span>time<span class="sc">+</span>marlene</span>
<span id="cb23-4"><a href="interactions.html#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>time2<span class="sc">+</span>george<span class="sc">*</span>time<span class="sc">+</span>george<span class="sc">*</span>time2<span class="sc">+</span>mg<span class="sc">*</span>time<span class="sc">+</span>mg<span class="sc">*</span>time2);<span class="fu">summary</span>(model4) </span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = tonnage ~ time + time2 + time3 + marlene + george + 
##     mg + cosm[, 1] + sinm[, 1] + cosm[, 2] + sinm[, 2] + cosm[, 
##     3] + sinm[, 3] + cosm[, 4] + sinm[, 4] + cosm[, 5] + sinm[, 
##     5] + cosm[, 6] + sinm[, 6] + cosm[, 7] + sinm[, 7] + cosm[, 
##     8] + sinm[, 8] + marlene * time + marlene * time2 + george * 
##     time + george * time2 + mg * time + mg * time2)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -161.715  -40.721    0.693   43.050  202.251 
## 
## Coefficients:
##                 Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    3.214e+02  4.543e+01   7.075 9.18e-11 ***
## time           2.478e+00  1.787e+00   1.386 0.168165    
## time2         -3.744e-02  2.242e-02  -1.670 0.097428 .  
## time3          1.751e-04  9.036e-05   1.938 0.054883 .  
## marlene       -1.018e+02  4.932e+01  -2.063 0.041145 *  
## george        -5.130e+01  4.885e+01  -1.050 0.295639    
## mg             1.122e+03  5.218e+02   2.149 0.033514 *  
## cosm[, 1]     -6.896e+00  8.031e+00  -0.859 0.392149    
## sinm[, 1]     -2.557e+01  8.932e+00  -2.863 0.004912 ** 
## cosm[, 2]     -5.319e+00  8.029e+00  -0.663 0.508861    
## sinm[, 2]     -5.851e+01  8.132e+00  -7.195 4.93e-11 ***
## cosm[, 3]      8.395e+00  7.943e+00   1.057 0.292563    
## sinm[, 3]     -3.154e+01  8.036e+00  -3.925 0.000142 ***
## cosm[, 4]     -2.853e+01  7.973e+00  -3.579 0.000491 ***
## sinm[, 4]      4.784e+00  7.908e+00   0.605 0.546281    
## cosm[, 5]     -1.395e+01  7.957e+00  -1.753 0.081997 .  
## sinm[, 5]     -5.315e+00  7.875e+00  -0.675 0.500986    
## cosm[, 6]     -1.035e+01  7.995e+00  -1.294 0.198057    
## sinm[, 6]      5.763e+00  7.820e+00   0.737 0.462533    
## cosm[, 7]     -1.616e+01  8.054e+00  -2.006 0.046967 *  
## sinm[, 7]      1.078e+01  7.889e+00   1.366 0.174256    
## cosm[, 8]     -6.667e+00  8.100e+00  -0.823 0.412025    
## sinm[, 8]      1.351e+01  7.892e+00   1.712 0.089353 .  
## time:marlene  -1.870e+00  1.409e+00  -1.327 0.186946    
## time2:marlene  1.044e-02  8.569e-03   1.219 0.225306    
## time:george   -2.216e+00  1.403e+00  -1.579 0.116765    
## time2:george   9.076e-03  8.564e-03   1.060 0.291293    
## time:mg       -3.957e+01  2.043e+01  -1.936 0.055057 .  
## time2:mg       2.945e-01  1.489e-01   1.977 0.050219 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 68.47 on 126 degrees of freedom
## Multiple R-squared:  0.7007, Adjusted R-squared:  0.6342 
## F-statistic: 10.53 on 28 and 126 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>F test comparing model 4 and model 1</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="interactions.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model1, model4)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: tonnage ~ time + time2 + time3 + marlene + george + mg + cosm[, 
##     1] + sinm[, 1] + cosm[, 2] + sinm[, 2] + cosm[, 3] + sinm[, 
##     3] + cosm[, 4] + sinm[, 4]
## Model 2: tonnage ~ time + time2 + time3 + marlene + george + mg + cosm[, 
##     1] + sinm[, 1] + cosm[, 2] + sinm[, 2] + cosm[, 3] + sinm[, 
##     3] + cosm[, 4] + sinm[, 4] + cosm[, 5] + sinm[, 5] + cosm[, 
##     6] + sinm[, 6] + cosm[, 7] + sinm[, 7] + cosm[, 8] + sinm[, 
##     8] + marlene * time + marlene * time2 + george * time + george * 
##     time2 + mg * time + mg * time2
##   Res.Df    RSS Df Sum of Sq      F  Pr(&gt;F)  
## 1    140 712345                              
## 2    126 590640 14    121705 1.8545 0.03762 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="interactions.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ts</span>(<span class="fu">resid</span>(model4)))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Estimation of the lost tonnage and lost revenue, with a 95% confidence interval</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="interactions.html#cb28-1" aria-hidden="true" tabindex="-1"></a>xmatrixtons <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(marlene, george,mg), <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb28-2"><a href="interactions.html#cb28-2" aria-hidden="true" tabindex="-1"></a>betaesttons <span class="ot">&lt;-</span> <span class="fu">coef</span>(model1)[<span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb28-3"><a href="interactions.html#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fu">sum</span>(xmatrixtons<span class="sc">%*%</span>betaesttons)</span></code></pre></div>
<pre><code>## [1] 19568.49</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="interactions.html#cb30-1" aria-hidden="true" tabindex="-1"></a>xmatrixrev <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(marlene<span class="sc">*</span>fee, george<span class="sc">*</span>fee, mg<span class="sc">*</span>fee), <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb30-2"><a href="interactions.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fu">sum</span>(xmatrixrev<span class="sc">%*%</span>betaesttons)</span></code></pre></div>
<pre><code>## [1] 611479.7</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="interactions.html#cb32-1" aria-hidden="true" tabindex="-1"></a>r<span class="ot">&lt;-</span><span class="fu">cbind</span>(<span class="fu">sum</span>(marlene<span class="sc">*</span>fee),<span class="fu">sum</span>(george<span class="sc">*</span>fee),<span class="fu">sum</span>(mg<span class="sc">*</span>fee)) </span>
<span id="cb32-2"><a href="interactions.html#cb32-2" aria-hidden="true" tabindex="-1"></a>sdest<span class="ot">&lt;-</span><span class="fu">sqrt</span>(r<span class="sc">%*%</span><span class="fu">vcov</span>(model1)[<span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>]<span class="sc">%*%</span><span class="fu">t</span>(r)) </span>
<span id="cb32-3"><a href="interactions.html#cb32-3" aria-hidden="true" tabindex="-1"></a>sdest </span></code></pre></div>
<pre><code>##         [,1]
## [1,] 55363.1</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="interactions.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="do">## confidence interval calculations</span></span>
<span id="cb34-2"><a href="interactions.html#cb34-2" aria-hidden="true" tabindex="-1"></a>lcl <span class="ot">&lt;-</span><span class="sc">-</span><span class="fu">sum</span>(xmatrixrev<span class="sc">%*%</span>betaesttons)<span class="sc">-</span><span class="fl">1.96</span><span class="sc">*</span>sdest</span>
<span id="cb34-3"><a href="interactions.html#cb34-3" aria-hidden="true" tabindex="-1"></a>ucl<span class="ot">&lt;-</span><span class="sc">-</span><span class="fu">sum</span>(xmatrixrev<span class="sc">%*%</span>betaesttons)<span class="sc">+</span><span class="fl">1.96</span><span class="sc">*</span>sdest </span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="multiple-regression-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="distributed-lag-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/katjanewilson/Time-Series-Forecasting/edit/master/03-topic.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/katjanewilson/Time-Series-Forecasting/blob/master/03-topic.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
